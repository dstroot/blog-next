---
title: 'Embed a Tweet in your .mdx blog'
published: true
date: '2022-02-07'
summary: Sometimes you just want to add a Tweet to a post. Should be simple, right?
icon: react
tags:
  # - Javascript
  # - React Hook
  - React Component
#   - CSS
#   - HTML
---

So, you have a .mdx file and you want to embed a tweet? 

<Step number={1} title='Simply paste the twitter embed code' />

If you simply paste the twitter embed code into your .mdx file, you will get a tweet.  But it may not look great, and it will throw errors.  Let's fix that.

<Step number={2} title='Clean up the twitter embed code' />

First off the "class" attribute needs to be changed to "className". Then "charset" needs to be changed to "charSet". Then you you need to make sure no browser add-ins are blocking social media trackers otherwise you will get errors. You also need to ake sure your CSP policy allows the twitter script to be loaded.

I also still see console warnings:

* "Warning: Did not expect server HTML to contain a &lt;div&gt; in &lt;div&gt;."
* "Warning: validateDOMNesting(...): &lt;a&gt; cannot appear as a descendant of &lt;a&gt;."

In any case, here it is:

<blockquote className="twitter-tweet"><p lang="en" dir="ltr">MDX Embed is now finally stable and i&#39;ve released v1.0.0 ðŸ¥³ -- Complete with <a href="https://twitter.com/GatsbyJS?ref_src=twsrc%5Etfw">@GatsbyJS</a> 4 support! <a href="https://twitter.com/hashtag/MDX?src=hash&amp;ref_src=twsrc%5Etfw">#MDX</a> 2 compatibility coming soon -- i hope! ðŸ¥µ<a href="https://t.co/1pudBFe4MV">https://t.co/1pudBFe4MV</a></p>&mdash; Paul Scanlon (@PaulieScanlon) <a href="https://twitter.com/PaulieScanlon/status/1490453997953630208?ref_src=twsrc%5Etfw">February 6, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charSet="utf-8"></script>

If that works for you then you are done!

<Step number={3} title='Use a React component in .mdx' />

For me, for some reason, I could never get the "just paste in the embed code" to work very well. I'd have to refresh the page to get the Tweet to format properly. I believe it's because Next serves a pre-rendered page and then hydrates the page. Initially the Tweet will not render properly. But after the page is refreshed, the Tweet will render as you would expect.

For me, it just had lots of ways to break. Plus I could not figure out how to make it work with Next dark mode. Sigh.

The best and easiest option I found is [MDX Embed](https://www.mdx-embed.com/?path=/docs/introduction--page) which also gives you the capability of adding LOTS of different embeds in addition to Twitter. It's pretty awesome. 

https://github.com/PaulieScanlon/mdx-embed 

<Step number={4} title='Roll your own custom React tweet component and API' />

If you are a "full control" kind of person this is your route and where I ended up. First, let's check out what Lee Robinson, Director of Developer Relations at Vercel, does on his personal blog. He has a Tweets page that is really fast [here](https://leerob.io/tweets). The secret is he is pre-rendering the tweets and then embedding them in the page. Wait, what!?

Let's check out his [repo](https://github.com/leerob/leerob.io) and see the magic.

<CustomTweet tweetID="1490453997953630208" />

<CodeBlock>

```js
export const getTweets = async (ids) => {
  if (ids.length === 0) {
    return [];
  }

  const queryParams = new URLSearchParams({
    ids: ids.join(','),
    expansions:
      'author_id,attachments.media_keys,referenced_tweets.id,referenced_tweets.id.author_id',
    'tweet.fields':
      'attachments,author_id,public_metrics,created_at,id,in_reply_to_user_id,referenced_tweets,text',
    'user.fields': 'id,name,profile_image_url,protected,url,username,verified',
    'media.fields':
      'duration_ms,height,media_key,preview_image_url,type,url,width,public_metrics'
  });

  const response = await fetch(
    `https://api.twitter.com/2/tweets?${queryParams}`,
    {
      headers: {
        Authorization: `Bearer ${process.env.TWITTER_API_KEY}`
      }
    }
  );

  const tweets = await response.json();

  const getAuthorInfo = (author_id) => {
    return tweets.includes.users.find((user) => user.id === author_id);
  };

  const getReferencedTweets = (mainTweet) => {
    return (
      mainTweet?.referenced_tweets?.map((referencedTweet) => {
        const fullReferencedTweet = tweets.includes.tweets.find(
          (tweet) => tweet.id === referencedTweet.id
        );

        return {
          type: referencedTweet.type,
          author: getAuthorInfo(fullReferencedTweet.author_id),
          ...fullReferencedTweet
        };
      }) || []
    );
  };

  return tweets.data.reduce((allTweets, tweet) => {
    const tweetWithAuthor = {
      ...tweet,
      media:
        tweet?.attachments?.media_keys.map((key) =>
          tweets.includes.media.find((media) => media.media_key === key)
        ) || [],
      referenced_tweets: getReferencedTweets(tweet),
      author: getAuthorInfo(tweet.author_id)
    };

    return [tweetWithAuthor, ...allTweets];
  }, []);
};
```

</CodeBlock>

